---
title: 'Titanic Survival Analysis'
author: 'Jacob Salway'
output:
  html_document:
    number_sections: true
    toc: true
    theme: lumen
    highlight: tango
---

# Intro

In this report, I will analyse the Titanic dataset from the challenge hosted on Kaggle. I will do:

* Cleaning and missing value imputation
* Exploratory data analysis
* Feature engineering
* Prediction

## Load data

```{r, message=F}
# load packages
library(ggplot2)
library(dplyr)
library(janitor)
```

After loading the packages, let's take a look at the data.

```{r, message=F, warning=F}
train <- read.csv('data/train.csv')
test <- read.csv('data/test.csv')

# for separation later
train$source <- 'train'
test$source <- 'test'

# combine
full <- bind_rows(train, test)

# clean names
full <- clean_names(full)

# check data
str(full)
```

Let's just reclassify some existing variables to factors.

```{r}
cols = c("survived", "pclass", "embarked", "source")
for (i in cols) {
  full[,i] <- as.factor(full[,i])
}
```

## Missing values

Let's take a look at what's missing.

```{r}
colSums(is.na(full))
colSums(full == '')
```

We can see that we have a lot of missing age and cabin values, one missing fare value and two missing embarked values. The missing survival values are due to the test dataset not having a survival factor given. For fare and embarked, we'll just impute with the median and mode respectively.

```{r}
full$fare[is.na(full$fare)] <- median(full$fare, na.rm=T)

# ugly workaround for mode of factor
full$embarked[full$embarked == ''] <- tail(names(sort(table(full$embarked))), 1)
```

To impute the age, we're going to use a slightly better method than just using the median. Instead, we're going to sample from the existing distribution of ages.

```{r}
freq = data.frame(table(full$age))
freq = freq[freq$Var1 != "",]
freq$prob <- freq$Freq / sum(freq$Freq)
size = nrow(full[is.na(full$age),]) # num rows to sample

sampled = sample(freq$Var1, prob=freq$prob, replace=T, size=size)
full$age[is.na(full$age)] <- sampled
```

Let's compare the distribution of the sampled ages to the real ages.

```{r}
full %>%
  ggplot(aes(x=age)) +
  geom_histogram()

t = data.frame(sampled)
t$sampled = as.numeric(t$sampled)
t %>%
  ggplot(aes(x=sampled)) +
  geom_histogram()
```

Let's check that we sorted out those null values.

```{r}
colSums(is.na(full))
colSums(full == '')
```